name: deploy to s3

on:
  push:
    branches:
      - main
    paths:
      - 'pj-corridor.net/index.html'
      - 'pj-corridor.net/images/**'
      - 'pj-corridor.net/cube3d/**'
      - 'stick-figure/**'

jobs:
  deploy:
    runs-on: ubuntu-latest
    env:
      INDEXPATH: pj-corridor.net/index.html
      IMAGEPATH: pj-corridor.net/images/
      APPL1PATH: pj-corridor.net/cube3d/
      APPL2PATH: stick-figure/
    steps:
    - name: checkout
      uses: actions/checkout@v3
    - name: configure credentials
      uses: aws-actions/configure-aws-credentials@v3
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ap-northeast-1
    - name: copy-1
      if: ${{ contains(join(github.event.commits[*].modified, ','), env.INDEXPATH) }}
      run: |
        aws s3 cp ${{ env.INDEXPATH }} s3://pj-corridor.net/index.html
    - name: sync-1
      if: ${{ contains(join(github.event.commits[*].modified, ','), env.IMAGEPATH) }}
      run: |
        aws s3 sync ${{ env.IMAGEPATH }} s3://pj-corridor.net/images/ --exclude ".git/*"
    - name: sync-2
      if: ${{ contains(join(github.event.commits[*].modified, ','), env.APPL1PATH) }}
      run: |
        aws s3 sync ${{ env.APPL1PATH }} s3://pj-corridor.net/cube3d/ --exclude ".git/*"
    - name: sync-3
      if: ${{ contains(join(github.event.commits[*].modified, ','), env.APPL2PATH) }}
      run: |
        aws s3 sync ${{ env.APPL2PATH }} s3://pj-corridor.net/stick-figure/ --exclude ".git/*"

