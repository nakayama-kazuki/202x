# ま、また釣りかよ !!

こんにちは、広告エンジニア兼、安全確保支援士の中山です。

広告経由のフィッシング詐欺のみならず、フィッシング関連ニュースが後を絶ちませんが、今回は攻撃者の立場に立って

<img src='https://raw.githubusercontent.com/nakayama-kazuki/202x/main/phishing/img/0.png' />

の 1～6 について考察を深めることで、我々自身を守るためのヒントとしたいと思います。彼を知り己を知れば百戦殆からず、ですね。ちなみに、以前にも [同様のタイトルの記事](https://www.techscore.com/blog/2017/12/10/phishing/) を書きましたが、今回はそのアップデート版との位置づけです。

## 1. メールや SMS からフィッシングサイトに誘導

<img src='https://raw.githubusercontent.com/nakayama-kazuki/202x/main/phishing/img/1.png' />

#### 1.1. メール送信（直接）

まずは攻撃者が直接メールを送信するケースについて考えてみます。攻撃者としては、とにもかくにもメールを開封してもらう必要があり、そのために重要なのは題名です。そこで …

- ありがちで、かつ興味をひく題名を使う<br />（例えば「Re: 勤怠連絡」や「退職のご挨拶」）
- Non-Delivery Report を偽装する

などの手段を用います。前者の「退職のご挨拶」については、手続きにより会社のアカウントが利用できなくなることもあり、社外ドメインからのメール送信でも違和感が少ない点が攻撃者にとって好都合です。後者はメールアドレスを間違えた際の MTA から送信されるレポートを偽装し、リンク先で詳細情報を確認させる体裁でフィッシングサイトに誘導します。

#### 1.2. メール送信（間接）

次いで攻撃者が SaaS の通知機能を活用して間接的にメールを送信するケースについて考えてみます。このケースの場合、ターゲットに疑われにくい点が攻撃者にとって好都合です。例えば Google ドキュメントのメンションからフィッシングサイトの URL を含んだメールを送信することが可能でした。この問題については Google から [対策が示されました](https://workspaceupdates.googleblog.com/2022/03/more-information-in-comment-notifications-gmail.html) が、今後も通知機能を有した SaaS は攻撃の隠れ蓑として利用される可能性があります。

#### 1.3. SMS 送信

最後に攻撃者が SMS を送信するケースについて考えてみます。SMS の場合は送信者 ID 毎にメッセージがスレッド表示されますが、攻撃者が送信者 ID を詐称し、正規のサービサーと同じスレッドに攻撃者のメッセージが表示される可能性があります。ちなみに SMS を使ったフィッシングをスミッシングを呼ぶそうです。

- [フィッシング対策協議会からの注意喚起](https://www.antiphishing.jp/news/alert/docomo_20190621.html)
- [ソフトバンクからの注意喚起](https://www.softbank.jp/mobile/info/personal/news/support/20200304a/)

## 2. Web サービスからフィッシングサイトに誘導

<img src='https://raw.githubusercontent.com/nakayama-kazuki/202x/main/phishing/img/2.png' />

Web サービスからの誘導でよく使われる手段に

- 掲示板など UGC コンテンツからの誘導
- コミュニケーション機能をもった Web サービスからの誘導

があります。前者は「お宝画像はこちら」などの投稿が典型例です。リンク先で待ち構えているのはお宝画像ではなくフィッシングサイトかもしれません。後者については最近ヤフオクから [質問機能を使ったフィッシングサイト誘導](https://auctions.yahoo.co.jp/topic/notice/other/post_3333/) についての注意喚起がありましたね。

## 3. フィッシングサイトの URL を詐称

<img src='https://raw.githubusercontent.com/nakayama-kazuki/202x/main/phishing/img/3.png' />

URL の詐称によく使われる手段として

- ショート URL サービスを使う
- プロクシ機能を持つサービスに便乗
- オープンリダイレクト（脆弱性）に便乗
- テキストと実際のリンク先の異なる A 要素の活用

などがあります。例えば …

```
https://translate.google.com/translate?u=xn--lhr645fjve.jp
```

は URL としては Google サービスですが、表示されるのは総務省のコンテンツです。そして、実際に攻撃者が用いるのはフィッシングサイトです（蛇足ですが punycode を使ってカムフラージュした場合、コンテンツを想像することは一層困難ですね）。メールや SMS では URL がリンクとして扱われる場合もありますので、上記サンプルの場合、ターゲットは Google だと信じて誘導されてしまうかもしれません。攻撃者はこのような仕組みを使って URL をミスリードします。

また、こちら …

```
<a href='https://evil-phishing-site.com/'>
    https://docs.google.com/document/d/FILE_ID/preview
</a>
```

は昔からよく使われる URL 詐称の方法で、タグが入稿できる UGC や HTML メールなどで使われます。公的な案内（を偽装したメッセージ）が Google ドキュメントにリンクしているのは違和感は少ないですよね。そしてターゲットは evil-phishing-site.com に誘導されてしまいます。

## 4. 悪意あるサイトを信頼させる

<img src='https://raw.githubusercontent.com/nakayama-kazuki/202x/main/phishing/img/4.png' />

ここでは二種類の方法をご紹介します。

#### 4.1. オートフィルで信頼を獲得

一つ目は IPA からの [Web メールサービスのアカウントを標的としたフィッシングに関する注意喚起](https://www.jpcert.or.jp/at/2021/at210049.html) で説明されている方法です。

1. 攻撃者はフィッシングサイトに誘導するメールを送信する
2. フィッシングサイトの URL パラメータにメールアドレスを（例えば base64 等でエンコードしつつ）含めます
3. フィッシングサイト側ではパラメータからメールアドレスを復元し、入力欄にオートフィルします
4. ターゲットは 3. によって正規のサービスであると信じ、パスワードを（攻撃者に）送信してしまいます

攻撃者は大量にランダム生成したメールアドレスがたまたまヒットした場合であれ、予めターゲットとなるメールアドレスのリストを入手していた場合であれ 1. の時点でメールアドレスを把握しています。それを URL パラメータに紛れ込ませ、フィッシングサイトでオートフィルするだけ、という簡単なトリックですがターゲットの信頼を獲得する効果は十分にありそうです。

#### 4.2. ヒストリバック … のつもりが

二つ目は [以前の記事](https://www.techscore.com/blog/2017/12/10/phishing/) でご紹介した方法です。UGC 等からおとりサイトに誘導し、ターゲットは自分が欲しい情報がないためヒストリバックします。しかし、実際には元の UGC を模したフィッシングサイトに誘導されてしまいます。ターゲットに「ヒストリバックで元のサイトに戻った」と信じさせることができれば、その後再ログインを促すなどで秘密情報を盗み出すことも可能になります。

<img src='https://raw.githubusercontent.com/nakayama-kazuki/202x/main/phishing/demo/2-3.png' />

こちらに [デモサイト](https://pj-corridor.net/phishing-demo/trust.html) を用意したので動作をご確認ください。

## 5. その他攻撃手段

<img src='https://raw.githubusercontent.com/nakayama-kazuki/202x/main/phishing/img/5.png' />

これまで挙げたもの以外にも攻撃手段があります。

#### 5.1. QR コード

攻撃者は QR コードを利用してターゲットをフィッシングサイトに誘導するだけでなく、QR コードから直接攻撃を実行することも考えられます（実は QR コードから実行可能な機能はいろいろとあります）。

#### 5.2. カスタムスキーム（の脆弱性）

かつて x-avefront というスキームが社会問題となりましたが、同様の問題が WebView を使うアプリにも発生する可能性があります。さらにフィッシングサイトがこの脆弱性を利用する可能性があります。

#### 5.3. Consent Phishing

業務で活用する SaaS が増えると、コラボレーション用途で SaaS から認可を求める通知を受ける機会も増えます。認可要求に対して反射的に承諾してしまう層が一定数存在するかもしれませんが、悪意あるアプリが認可を得てしまうとターゲットへの攻撃もしくはその前段の情報収集が可能になります。詳しくは [Microsoft の解説](https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/protect-against-consent-phishing) をご覧ください。

## 6. 悪意ある攻撃を成功に導く

<img src='https://raw.githubusercontent.com/nakayama-kazuki/202x/main/phishing/img/6.png' />

そして、いよいよ攻撃者は目的を達成します。

#### 6.1. Callback Phishing

あなたの PC から異常な通信が検知されました、と連絡を受けたターゲットは記載されていた電話番号にコールバックします。すると、リモート管理ツールのインストールを促され、ターゲットはマルウェアのインストールを許してしまいます。

#### 6.2. 偽の決済画面

リダイレクト型の決済方法（外部のサイトに決済を委ねる）の EC ショップがサイトの改ざんを受けた場合、ターゲットはフィッシングサイト（偽の決済画面）に誘導されてしまう可能性があります。攻撃者はターゲットの秘密情報を盗みとった後に決済エラー … 例えばトランザクションの混雑などの理由をつけて … を装い、正規の決済画面にターゲットをリダイレクトし、ターゲットは改めて決済を完了します。ターゲットは秘密情報を盗まれたことすら気付けません。

#### 6.3. 偽のソーシャルログイン

フィッシングサイトがソーシャルログイン機能を有していた場合、サービスに興味を持ったターゲットはソーシャルログインを試みるかもしれません。しかしながら、その IdP 自体がフィッシングサイトである可能性もあります。疑いを持てなかったターゲットは秘密情報を盗まれてしまいます。

#### 6.4. 多要素認証の Man In The Middle 攻撃

多要素認証を使っていれば万が一にも大丈夫、とおもいきや多要素認証を突破する Man In The Middle 攻撃について [Microsoft からの注意喚起](https://www.microsoft.com/security/blog/2022/07/12/from-cookie-theft-to-bec-attackers-use-aitm-phishing-sites-as-entry-point-to-further-financial-fraud/) がありました。

## まとめ

以上、攻撃者のクリエイティビティー（苦笑）はいかがでしたでしょうか。そのクリエイティビティーを違うことに発揮してほしいですよね。業務でもプライベートでも、似たようなシチュエーションに遭遇する可能性はあると思いますが、そのようなときに「ん？ちょっと待てよ」とフィッシングの可能性を疑ってみてください。


